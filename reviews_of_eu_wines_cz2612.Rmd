---
title: "Reviews of European Wines"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include = FALSE}
library(tidyverse)
library(patchwork)
library(plotly)
library(flexdashboard)

knitr::opts_chunk$set(
	fig.width = 10, 
  fig.asp = .6,
  out.width = "100%"
)
```

<br/>

### European Countries Comparison

```{r European Countries Bar Plot, message = FALSE, warning = FALSE}
load("./data/wine150_tidy")

wine150_tidy %>% 
  select(country, points_avg_country) %>% 
  filter(country %in% c("Albania", "Austria", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "England", "France", "Germany", "Greece", "Hungary", "Italy", "Lithuania", "Luxembourg", "Macedonia", "Moldova", "Montenegro", "Portugal", "Romania", "Serbia", "Slovakia", "Slovenia", "Spain", "Switzerland", "Ukraine")) %>% 
  mutate(country = fct_reorder(country, desc(points_avg_country))) %>% 
  unique() %>% 
  mutate(text_label = str_c("Country: ", country, "\nAverage Points: ", points_avg_country)) %>% 
  plot_ly(
    x = ~country, y = ~points_avg_country, color = ~factor(country), text = ~text_label,
    type = "bar", colors = "viridis") %>%
  layout(
    xaxis = list(title = "European Countries"),
    yaxis = list(title = "Average Wine Points", range = (c(80,92))),
    title = "Average Wine Points of European Countries")
```

After calculating average wine points for each of the 26 European countries, we find out that England has the highest average wine points (92.9) and Montenegro has the lowest average wine points (82). Generally speaking, we could see a trend from the bar plot: the richer West European countries have relatively higher average wine points and the less wealthy East European countries have relatively lower average wine points.

<br/>

### Top 20 European Wineries

```{r Top 20 European Wineries Box Plot, message = FALSE, warning = FALSE}
load("./data/wine150_tidy")

wine150_tidy %>% 
  select(points, country, winery, variety, points_avg_variety, points_avg_winery) %>% 
  filter(country %in% c("Albania", "Austria", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "England", "France", "Germany", "Greece", "Hungary", "Italy", "Lithuania", "Luxembourg", "Macedonia", "Moldova", "Montenegro", "Portugal", "Romania", "Serbia", "Slovakia", "Slovenia", "Spain", "Switzerland", "Ukraine")) %>% 
  mutate(winery = fct_reorder(winery, desc(points_avg_winery))) %>% 
  filter(as.numeric(winery) <= 20) %>% 
  arrange(winery) %>% 
  plot_ly(
    x = ~winery, y = ~points, color = ~factor(winery),
    type = "box", colors = "viridis") %>%
  layout(
    xaxis = list(title = "European Wineries"),
    yaxis = list(title = "Wine Points"),
    title = "Top 20 European Wineries: Highest Professional Recognition")
```

<br/>

### Bottom 20 European Wineries

```{r Bottom 20 European Wineries Box Plot, message = FALSE, warning = FALSE}
load("./data/wine150_tidy")

wine150_tidy %>% 
  select(points, country, winery, variety, points_avg_variety, points_avg_winery) %>% 
  filter(country %in% c("Albania", "Austria", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "England", "France", "Germany", "Greece", "Hungary", "Italy", "Lithuania", "Luxembourg", "Macedonia", "Moldova", "Montenegro", "Portugal", "Romania", "Serbia", "Slovakia", "Slovenia", "Spain", "Switzerland", "Ukraine")) %>% 
  mutate(winery = fct_reorder(winery, points_avg_winery)) %>% 
  filter(as.numeric(winery) <= 20) %>% 
  arrange(winery) %>% 
  plot_ly(
    x = ~winery, y = ~points, color = ~factor(winery),
    type = "box", colors = "viridis") %>%
  layout(
    xaxis = list(title = "European Wineries"),
    yaxis = list(title = "Wine Points"),
    title = "Bottom 20 European Wineries: Lowest Professional Recognition")
```

<br/>

### Top 10 Grapes for European Wines

```{r Most Favorable European Grapes Violin Plot, message = FALSE, warning = FALSE}
load("./data/wine150_tidy")

wine150_tidy %>% 
  select(points, country, winery, variety, points_med_variety, points_med_winery) %>% 
  filter(country %in% c("Albania", "Austria", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "England", "France", "Germany", "Greece", "Hungary", "Italy", "Lithuania", "Luxembourg", "Macedonia", "Moldova", "Montenegro", "Portugal", "Romania", "Serbia", "Slovakia", "Slovenia", "Spain", "Switzerland", "Ukraine")) %>% 
  mutate(variety = fct_reorder(variety, desc(points_med_variety))) %>% 
  filter(as.numeric(variety) <= 10) %>% 
  arrange(variety) %>% 
  plot_ly(
    x = ~variety, y = ~points, color = ~factor(variety),
    type = "violin", colors = "viridis") %>%
  layout(
    xaxis = list(title = "Grapes for European Wines"),
    yaxis = list(title = "Wine Points"),
    title = "Most Favorable 10 Grapes for European Wines: Highest Professional Recognition")
```

<br/>

### Bottom 10 Grapes for European Wines

```{r Least Favorable European Grapes Violin Plot, message = FALSE, warning = FALSE}
load("./data/wine150_tidy")

wine150_tidy %>% 
  select(points, country, winery, variety, points_med_variety, points_med_winery) %>% 
  filter(country %in% c("Albania", "Austria", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "England", "France", "Germany", "Greece", "Hungary", "Italy", "Lithuania", "Luxembourg", "Macedonia", "Moldova", "Montenegro", "Portugal", "Romania", "Serbia", "Slovakia", "Slovenia", "Spain", "Switzerland", "Ukraine")) %>% 
  mutate(variety = fct_reorder(variety, points_med_variety)) %>% 
  filter(as.numeric(variety) <= 10) %>% 
  arrange(variety) %>% 
  plot_ly(
    x = ~variety, y = ~points, color = ~factor(variety),
    type = "violin", colors = "viridis") %>%
  layout(
    xaxis = list(title = "Grapes for European Wines"),
    yaxis = list(title = "Wine Points"),
    title = "Least Favorable 10 Grapes for European Wines: Lowest Professional Recognition")
```

